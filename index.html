<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Filemoon Stream</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  background:#0f0f0f;
  color:#fff;
  font-family:system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  margin:0;
}

.container {
  max-width:1000px;
  margin:auto;
  padding:16px;
}

h2, h3 {
  margin:20px 0 12px;
}

.player iframe {
  width:100%;
  height:420px;
  border-radius:12px;
  background:#000;
  border:0;
}

.grid {
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(180px,1fr));
  gap:14px;
}

.card {
  cursor:pointer;
}

.card img {
  width:100%;
  border-radius:10px;
  background:#222;
}

.card p {
  font-size:14px;
  margin:6px 0 0;
  line-height:1.3;
}
</style>
</head>

<body>

<div class="container">

  <h2>ðŸŽ¬ Now Playing</h2>
  <div class="player">
    <iframe
      id="player"
      allowfullscreen
      allow="autoplay; fullscreen">
    </iframe>
  </div>

  <h3>ðŸ“º Video Lainnya</h3>
  <div id="videos" class="grid"></div>

</div>

<script>
const API = "https://raspy-heart-f318.ap5089393.workers.dev/videos";
const player = document.getElementById("player");
const list = document.getElementById("videos");

let FILES = [];

/* =========================
   HELPER
========================= */
function playVideo(code, title = "Filemoon Stream") {
  if (!code) return;
  player.src = `https://filemoon.to/e/${code}`;
  document.title = title;
  location.hash = `/e/${code}`;
  window.scrollTo({ top: 0, behavior: "smooth" });
}

/* =========================
   LOAD API
========================= */
fetch(API)
  .then(res => res.json())
  .then(data => {

    FILES =
      data?.result?.files ||
      data?.files ||
      data?.result ||
      [];

    if (!FILES.length) {
      console.warn("No videos found");
      return;
    }

    // render list
    FILES.forEach(v => {
      const card = document.createElement("div");
      card.className = "card";

      const thumb = v.single_img && v.single_img.trim() !== ""
        ? v.single_img
        : "https://dummyimage.com/320x180/000/fff&text=Video";

      card.innerHTML = `
        <img src="${thumb}" loading="lazy">
        <p>${v.title || "Untitled Video"}</p>
      `;

      card.onclick = () => playVideo(v.file_code, v.title);

      list.appendChild(card);
    });

    // autoplay from hash OR first video
    const hash = location.hash;
    const match = hash.match(/\/e\/([a-zA-Z0-9]+)/);

    if (match) {
      const code = match[1];
      playVideo(code);
    } else {
      playVideo(FILES[0].file_code, FILES[0].title);
    }
  })
  .catch(err => {
    console.error("API Error:", err);
  });

/* =========================
   HANDLE BACK / FORWARD
========================= */
window.addEventListener("hashchange", () => {
  const match = location.hash.match(/\/e\/([a-zA-Z0-9]+)/);
  if (!match) return;

  const code = match[1];
  const video = FILES.find(v => v.file_code === code);
  playVideo(code, video?.title || "Filemoon Stream");
});
</script>

</body>
</html>
